{{template "base" .}}

{{define "title"}}Get a reward{{end}}

{{define "body"}}
<div>
    <h4>Balance: {{.Balance}}</h4>
</div>

<div>
    <h4>Reward items count: {{.ItemsCount}}</h4>
</div>

<div>
    <h4>Real money reward: {{.MoneyReward}}</h4>
</div>

<form id="get-reward-form" action="/get-reward" method="post">
    <div class="container">
        <label for="get-reward-btn"><b>Request a reward</b></label><br/>
        <button id="get-reward-btn" type="submit">Request a reward</button>
    </div>
</form>
<div id="submit-reward-modal" class="modal">
    <p id="reward-tag"></p>
    <button id="submit-reward-btn">Submit</button>
    <p>or</p>
    <a href="#" rel="modal:close">Dismiss</a>
</div>

<script>
    const rewardPrefix = "Here is your reward: ";
    var reward = null
    $("#get-reward-form").submit(function(e) {
        e.preventDefault();
        $("#reward-tag").innerHTML = "";

        let form = $(this);
        let actionUrl = form.attr('action');
        $.ajax({
            type: "POST",
            url: actionUrl,
            xhrFields: {
                withCredentials: true
            },
            success: function(data)
            {
                reward = data
                $("#reward-tag").text(rewardPrefix + reward.type + " - " + reward.amount);
                $("#submit-reward-modal").modal({
                    escapeClose: false,
                    clickClose: false,
                    showClose: false
                });
            }
        });
    });
    $("#submit-reward-btn").click(function() {
        let actionUrl = "/submit-reward"
        $.ajax({
            type: "POST",
            url: actionUrl,
            data: reward,
            xhrFields: {
                withCredentials: true
            },
            success: function(data)
            {
                console.dir(data);
                $("#submit-reward-modal").modal("hide");
                reward = null;
            }
        });
    })
</script>
{{end}}